name: Vala CI

on: push

jobs:
  lint:
    runs-on: ubuntu-latest
    container:
      image: elementary/docker:juno-unstable
    steps:
      - uses: actions/checkout@v1
      - name: Lint
        run: docker run -v "$PWD":/var/opt/vala-lint elementary/docker:vala-lint io.elementary.vala-lint -d .

  test:
    runs-on: ubuntu-latest
    container:
      image: elementary/docker:juno-unstable
    steps:
    - uses: actions/checkout@v1
    - name: Install Depedencies
      env:
        dependency_packages: meson gobject-introspection libgee-0.8-dev libgirepository1.0-dev libgtk-3-dev valac
      run: apt-get update && apt-get -y install ${dependency_packages}
    - name: Run Tests
      run: ninja test -C build

  build:
    runs-on: ubuntu-latest
    container:
      image: elementary/docker:juno-unstable
    steps:
    - uses: actions/checkout@v1
    - name: Install Depedencies
      env:
        dependency_packages: meson gobject-introspection libgee-0.8-dev libgirepository1.0-dev libgtk-3-dev valac
      run: apt-get update && apt-get -y install ${dependency_packages}
    - name: Build
      run: meson build && ninja -C build
